{"ast":null,"code":"var _jsxFileName = \"/Users/sidorelakollcaku/Desktop/Project1/src/Pages/DashboardScreens/WithOrganizations/SubmitGoals/SubmitGoalsTable.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport firebase from \"../../../../Config/FirebaseConfig\";\nimport { useParams } from \"react-router-dom\";\nimport ApprovedForm from \"./ApprovedForm\";\nimport { useSelector } from \"react-redux\";\nimport { useEffect } from \"react\";\nimport { send } from \"emailjs-com\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst SubmitGoalsTable = ({\n  selector,\n  btn,\n  undoFunc,\n  declineBtn,\n  approvedUndo,\n  declineForReported,\n  undoForReported,\n  undoFake\n}) => {\n  _s();\n\n  // const history = useHistory();\n  const {\n    id\n  } = useParams();\n  const db = firebase.database(); // approved form working\n\n  let [open, setOpen] = useState(false);\n  let [goalId, setGoalId] = useState(\"\");\n  let [percantage, setPercentage] = useState(\"\");\n  let [reward, setReward] = useState(\"\");\n  let [rewardRange, setRewardRange] = useState(\"\");\n  let [organizationUserId, setOrganizationUserId] = useState(\"\");\n  let [loading] = useState(false);\n  let [userBalance, setUserBalance] = useState(\"\");\n  let [userMyGoalId, setUserMyGoalId] = useState(\"\");\n  let [userInvest, setUserInvest] = useState(); // working for approved form\n\n  const openApprovedForm = event => {\n    setOpen(true);\n    setGoalId(event.submitGoalId);\n    setOrganizationUserId(event.orgUserId);\n    setUserMyGoalId(event.SubmitGoal.myGoalId);\n    setRewardRange(`${event.SubmitGoal.inputValues.rewardMin} - ${event.SubmitGoal.inputValues.rewardMax}`);\n    setUserInvest(event.SubmitGoal.userInvestment); // console.log(event)\n    // get organization user info to get prev balance\n\n    db.ref(`organizations/${id}/users/${event.orgUserId}`).on(\"value\", snapshot => {\n      let userData = snapshot.val();\n      let userBalancedb = userData.balance;\n      setUserBalance(userBalancedb);\n    });\n  };\n\n  const handlePercentage = event => {\n    setPercentage(event.target.value);\n  };\n\n  const handleReward = event => {\n    setReward(event.target.value);\n  }; // form close function\n\n\n  const handleClose = () => {\n    setOpen(false);\n  }; // goals approved function\n\n\n  const handleApprovedGoals = () => {\n    let approveData = {\n      approved: true,\n      pending: false,\n      percantage: percantage,\n      reward: reward,\n      submit: true,\n      isReport: false\n    };\n    let pendingData = {\n      approved: true,\n      percantage: percantage,\n      pending: true,\n      reward: reward,\n      submit: true,\n      isReport: false\n    };\n\n    if (percantage === \"100\") {\n      // add  balance in user acount\n      db.ref(`organizations/${id}/users/${organizationUserId}`).update({\n        balance: Number(userBalance) + Number(reward) + userInvest\n      }); // update goal status in users goal ref\n\n      db.ref(`organizations/${id}/users/${organizationUserId}/myGoals/${userMyGoalId}`).update(approveData); // update goal data in submit goal ref \n\n      db.ref(`organizations/${id}/submitGoals/${goalId}`).update(approveData);\n      setPercentage(\"\");\n      setReward(\"\");\n      handleClose();\n    } else {\n      // update goal data in submit goal ref \n      db.ref(`organizations/${id}/submitGoals/${goalId}`).update(pendingData); // add  balance in user acount\n\n      db.ref(`organizations/${id}/users/${organizationUserId}/myGoals/${userMyGoalId}`).update(pendingData);\n      handleClose();\n      setPercentage(\"\");\n      setReward(\"\");\n    }\n  };\n\n  const handleDeclineGoals = event => {\n    db.ref(`organizations/${id}/submitGoals/${event.submitGoalId}`).update({\n      decline: true\n    });\n    db.ref(`organizations/${id}/users/${event.orgUserId}/myGoals/${event.SubmitGoal.myGoalId}`).update({\n      decline: true\n    });\n  }; // goals undo decline function \n\n\n  const handleUndoDeclineGoals = event => {\n    db.ref(`organizations/${id}/submitGoals/${event.submitGoalId}`).update({\n      decline: false\n    });\n    db.ref(`organizations/${id}/users/${event.orgUserId}/myGoals/${event.SubmitGoal.myGoalId}`).update({\n      decline: false\n    });\n  }; // get user total balance\n\n\n  const balanceSelector = useSelector(state => {\n    return state.goalReducer.orgUsers;\n  }); // get all users of organization \n\n  const allUsersSelector = useSelector(state => {\n    return state;\n  }); // approved undo function\n\n  const handleApprovedUndo = event => {\n    const getPrevReward = event.reward;\n    const updateData = {\n      approved: false,\n      pending: false,\n      percantage: \"\",\n      reward: \"\"\n    };\n    balanceSelector.filter(val => {\n      if (val.id === event.orgUserId) {\n        let userBlnce = val.balance;\n        db.ref(`organizations/${id}/users/${event.orgUserId}`).update({\n          balance: userBlnce - (Number(getPrevReward) + event.SubmitGoal.userInvestment)\n        });\n        db.ref(`organizations/${id}/users/${event.orgUserId}/myGoals/${event.SubmitGoal.myGoalId}`).update(updateData);\n        db.ref(`organizations/${id}/submitGoals/${event.submitGoalId}`).update(updateData);\n      }\n    });\n  }; // undo reported goal\n\n\n  const handleUndoReportedGoals = event => {\n    db.ref(`organizations/${id}/submitGoals/${event.submitGoalId}`).update({\n      isReport: false\n    }); // console.log(event)\n  }; // accept reporting request if any user is  reported goal\n\n\n  const handleDeclineReportGoals = event => {\n    const getPrevReward = event.reward;\n    const updateData = {\n      approved: false,\n      percantage: \"\",\n      pending: false,\n      reward: \"\",\n      isReport: true,\n      acceptReport: true,\n      submit: false\n    };\n    balanceSelector.filter(val => {\n      // console.log(val,event)\n      if (val.id === event.orgUserId) {\n        let userBlnce = val.balance; //  balance minus from total balance\n\n        db.ref(`organizations/${id}/users/${event.orgUserId}`).update({\n          balance: userBlnce - (Number(getPrevReward) ? Number(getPrevReward) : 0)\n        }); // back to initial state\n\n        db.ref(`organizations/${id}/submitGoals/${event.submitGoalId}`).update(updateData).then(() => {\n          allUsersSelector.userReducer.allUsers.filter(user => {\n            if (user.id === event.userIdMain) {\n              // console.log(user)\n              send( // process.env.REACT_APP_EMAIL_JS_SERVICE_ID,\n              // process.env.REACT_APP_EMAIL_JS_TEMPLATE_ID,\n              \"service_q1galup\", \"template_aq5fbiv\", {\n                to: user.email,\n                to_name: `${event.userName}`,\n                from_email_name: \"TRYVE\",\n                subject: \"\",\n                message: `TRYVE reported your goal please retake good picture. Thanks!`,\n                from: \"tryve@gmail.com\",\n                reply_to: \"tryve@gmail.com\"\n              }, process.env.REACT_APP_EMAIL_JS_USER_ID).then(() => {\n                console.log(\"success...\");\n              }).catch(err => {\n                console.log(\"admin Email sending FAILED...\", err);\n              });\n            }\n          });\n        });\n        db.ref(`organizations/${id}/users/${event.orgUserId}/myGoals/${event.SubmitGoal.myGoalId}`).update(updateData); // remove all likes of goal\n\n        db.ref(`organizations/${id}/likes/${event.submitGoalId}`).remove();\n        db.ref(`organizations/${id}/comments/${event.submitGoalId}`).remove();\n      }\n    });\n  }; // undo fake goals\n\n\n  const handleUndoFakeGoals = event => {\n    db.ref(`organizations/${id}/submitGoals/${event.submitGoalId}`).update({\n      acceptReport: false\n    });\n    db.ref(`organizations/${id}/users/${event.orgUserId}/myGoals/${event.SubmitGoal.myGoalId}`).update({\n      acceptReport: false\n    });\n  }; // submit goal image function\n\n\n  let [imgUrl, setImgUrl] = useState(\"\");\n  let [showImg, setShowImg] = useState(false);\n\n  const handleSeeImage = event => {\n    setImgUrl(event);\n    setShowImg(true);\n  };\n\n  const handleCloseImg = () => {\n    setShowImg(false);\n    setImgUrl(\"\");\n  }; // automatically approved working\n\n\n  useEffect(() => {\n    let approvedinterVal = setInterval(() => {\n      if (selector.length) {\n        // let filterDataForApproved =\n        selector.filter(val => {\n          if (!val.isReport && !val.decline && !val.acceptReport && !val.pending && val.submit && !val.approved) {\n            const inputVal = val.SubmitGoal.inputValues;\n            let getStartDate = new Date(val.SubmitGoal.GoalStartDate);\n            let endDate = new Date(getStartDate);\n            let currentDate = new Date();\n            endDate.setDate(endDate.getDate() + Number(inputVal.numberOfDays));\n            let randomNumGenerate = Math.floor(Math.random() * (Number(inputVal.rewardMax) - Number(inputVal.rewardMin) + Number(inputVal.rewardMin)));\n\n            if (currentDate.getTime() >= endDate.getTime()) {\n              const filterGoalUser = balanceSelector.filter(user => user.id === val.orgUserId);\n              const approvedObj = {\n                approved: true,\n                pending: false,\n                percantage: \"100\",\n                reward: randomNumGenerate,\n                submit: true,\n                isReport: false\n              };\n              db.ref(`organizations/${id}/users/${val.orgUserId}`).update({\n                balance: filterGoalUser[0].balance + randomNumGenerate + val.SubmitGoal.userInvestment\n              });\n              db.ref(`organizations/${id}/users/${val.orgUserId}/myGoals/${val.SubmitGoal.myGoalId}`).update(approvedObj);\n              db.ref(`organizations/${id}/submitGoals/${val.submitGoalId}`).update(approvedObj).then(() => {\n                console.log(\"auto approved\");\n              });\n              console.log(\"end\", val);\n            }\n          } // if goals is reported and not approved not pending only submit and someone reported then is would be decline autt\n          else if (val.isReport && !val.decline && !val.acceptReport && !val.pending && val.submit && !val.approved) {\n            // console.log(val)\n            const inputVal = val.SubmitGoal.inputValues; // let getSubmitDate = new Date(val.submitDate);\n\n            let getStartDate = new Date(val.SubmitGoal.GoalStartDate);\n            let endDate = new Date(getStartDate);\n            let currentDate = new Date();\n            endDate.setDate(endDate.getDate() + Number(inputVal.numberOfDays)); // console.log(currentDate.getTime() , endDate.getTime())\n\n            if (currentDate.getTime() >= endDate.getTime()) {\n              // console.log('is report', val)\n              db.ref(`organizations/${id}/submitGoals/${val.submitGoalId}`).update({\n                decline: true,\n                submit: false,\n                isReport: false\n              });\n              db.ref(`organizations/${id}/users/${val.orgUserId}/myGoals/${val.SubmitGoal.myGoalId}`).update({\n                decline: true,\n                submit: false,\n                isReport: false\n              });\n            }\n          }\n        });\n      }\n    }, 10000);\n    return () => {\n      clearInterval(approvedinterVal);\n    };\n  });\n\n  if (!selector.length) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"no goals\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 12\n    }, this);\n  } // console.log(selector);\n\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"table_container\",\n    children: [/*#__PURE__*/_jsxDEV(ApprovedForm, {\n      open: open,\n      handleClickOpen: openApprovedForm,\n      handleSelect: handlePercentage,\n      handleInputvalue: handleReward,\n      inputValue: reward,\n      btnValue: \"Approved\",\n      labelValue: \"Reward\",\n      range: rewardRange,\n      handleAddFunction: handleApprovedGoals,\n      handleClose: handleClose,\n      loading: loading\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ApprovedForm, {\n      handleClickOpen: handleSeeImage,\n      imgUrl: imgUrl,\n      open: showImg,\n      btnValue: \"Close\",\n      handleClose: handleCloseImg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"table_md\",\n      children: /*#__PURE__*/_jsxDEV(\"table\", {\n        className: \"goals_table\",\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Image\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 398,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Name\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 399,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"People Joined\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 400,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Time Limit\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 401,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Status\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 402,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"category\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 403,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Reward Range\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 404,\n              columnNumber: 15\n            }, this), !btn ? /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Actions\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 406,\n              columnNumber: 23\n            }, this) : null]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 396,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: selector.map(val => {\n            let goalStartDate = new Date(val.SubmitGoal.GoalStartDate);\n            const newDateForEndDate = new Date(val.submitDate);\n            const goalStartTime = goalStartDate.getTime();\n            const getEndTime = newDateForEndDate.getTime();\n            const oneDayTime = 1000 * 3600 * 24;\n            const takeNumberOfDays = (getEndTime - goalStartTime) / oneDayTime;\n            return /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"img\", {\n                  className: \"goals_img\",\n                  src: val.uploadImgUlr,\n                  alt: \"...\",\n                  onClick: () => handleSeeImage(val.uploadImgUlr)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 421,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 420,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: val.SubmitGoal.inputValues.eventName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 428,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: val.userName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 429,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: [val.SubmitGoal.inputValues.numberOfDays, \" days\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 430,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: takeNumberOfDays > val.SubmitGoal.inputValues.numberOfDays ? \"late\" : \"submit on time\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 431,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: val.SubmitGoal.inputValues.category\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 436,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: `${val.SubmitGoal.inputValues.rewardMin} - ${val.SubmitGoal.inputValues.rewardMax}`\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 437,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                className: \"actions_btns\",\n                children: [!btn ? /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => openApprovedForm(val),\n                  children: \"approved\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 440,\n                  columnNumber: 23\n                }, this) : null, !declineBtn ? !undoFunc ? /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"view_icons\",\n                  onClick: () => handleDeclineGoals(val),\n                  children: \"decline\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 446,\n                  columnNumber: 25\n                }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"view_icons\",\n                  onClick: !approvedUndo ? () => handleUndoDeclineGoals(val) : () => handleApprovedUndo(val),\n                  children: \"Undo\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 453,\n                  columnNumber: 25\n                }, this) : null, declineForReported ? /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"view_icons\",\n                  onClick: () => handleDeclineReportGoals(val),\n                  children: \"Accept Report\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 467,\n                  columnNumber: 23\n                }, this) : null, undoForReported ? /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"view_icons\",\n                  onClick: () => handleUndoReportedGoals(val),\n                  children: \"undo reported\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 475,\n                  columnNumber: 23\n                }, this) : null, undoFake ? /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"view_icons\",\n                  onClick: () => handleUndoFakeGoals(val),\n                  children: \"undo fake\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 483,\n                  columnNumber: 23\n                }, this) : null]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 438,\n                columnNumber: 19\n              }, this)]\n            }, val.submitGoalId, true, {\n              fileName: _jsxFileName,\n              lineNumber: 419,\n              columnNumber: 17\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 409,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 371,\n    columnNumber: 5\n  }, this);\n};\n\n_s(SubmitGoalsTable, \"tRQFKmWHcNNI7u24Lvy+kpz6Xpw=\", false, function () {\n  return [useParams, useSelector, useSelector];\n});\n\n_c = SubmitGoalsTable;\nexport default SubmitGoalsTable;\n\nvar _c;\n\n$RefreshReg$(_c, \"SubmitGoalsTable\");","map":{"version":3,"sources":["/Users/sidorelakollcaku/Desktop/Project1/src/Pages/DashboardScreens/WithOrganizations/SubmitGoals/SubmitGoalsTable.jsx"],"names":["React","useState","firebase","useParams","ApprovedForm","useSelector","useEffect","send","SubmitGoalsTable","selector","btn","undoFunc","declineBtn","approvedUndo","declineForReported","undoForReported","undoFake","id","db","database","open","setOpen","goalId","setGoalId","percantage","setPercentage","reward","setReward","rewardRange","setRewardRange","organizationUserId","setOrganizationUserId","loading","userBalance","setUserBalance","userMyGoalId","setUserMyGoalId","userInvest","setUserInvest","openApprovedForm","event","submitGoalId","orgUserId","SubmitGoal","myGoalId","inputValues","rewardMin","rewardMax","userInvestment","ref","on","snapshot","userData","val","userBalancedb","balance","handlePercentage","target","value","handleReward","handleClose","handleApprovedGoals","approveData","approved","pending","submit","isReport","pendingData","update","Number","handleDeclineGoals","decline","handleUndoDeclineGoals","balanceSelector","state","goalReducer","orgUsers","allUsersSelector","handleApprovedUndo","getPrevReward","updateData","filter","userBlnce","handleUndoReportedGoals","handleDeclineReportGoals","acceptReport","then","userReducer","allUsers","user","userIdMain","to","email","to_name","userName","from_email_name","subject","message","from","reply_to","process","env","REACT_APP_EMAIL_JS_USER_ID","console","log","catch","err","remove","handleUndoFakeGoals","imgUrl","setImgUrl","showImg","setShowImg","handleSeeImage","handleCloseImg","approvedinterVal","setInterval","length","inputVal","getStartDate","Date","GoalStartDate","endDate","currentDate","setDate","getDate","numberOfDays","randomNumGenerate","Math","floor","random","getTime","filterGoalUser","approvedObj","clearInterval","map","goalStartDate","newDateForEndDate","submitDate","goalStartTime","getEndTime","oneDayTime","takeNumberOfDays","uploadImgUlr","eventName","category"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,QAAgC,OAAhC;AACA,OAAOC,QAAP,MAAqB,mCAArB;AACA,SAASC,SAAT,QAA0B,kBAA1B;AACA,OAAOC,YAAP,MAAyB,gBAAzB;AACA,SAASC,WAAT,QAA4B,aAA5B;AACA,SAASC,SAAT,QAA0B,OAA1B;AACA,SAASC,IAAT,QAAqB,aAArB;;;AAEA,MAAMC,gBAAgB,GAAG,CAAC;AACxBC,EAAAA,QADwB;AAExBC,EAAAA,GAFwB;AAGxBC,EAAAA,QAHwB;AAIxBC,EAAAA,UAJwB;AAKxBC,EAAAA,YALwB;AAMxBC,EAAAA,kBANwB;AAOxBC,EAAAA,eAPwB;AAQxBC,EAAAA;AARwB,CAAD,KASnB;AAAA;;AACJ;AACA,QAAM;AAAEC,IAAAA;AAAF,MAASd,SAAS,EAAxB;AACA,QAAMe,EAAE,GAAGhB,QAAQ,CAACiB,QAAT,EAAX,CAHI,CAKJ;;AACA,MAAI,CAACC,IAAD,EAAOC,OAAP,IAAkBpB,QAAQ,CAAC,KAAD,CAA9B;AACA,MAAI,CAACqB,MAAD,EAASC,SAAT,IAAsBtB,QAAQ,CAAC,EAAD,CAAlC;AACA,MAAI,CAACuB,UAAD,EAAaC,aAAb,IAA8BxB,QAAQ,CAAC,EAAD,CAA1C;AACA,MAAI,CAACyB,MAAD,EAASC,SAAT,IAAsB1B,QAAQ,CAAC,EAAD,CAAlC;AACA,MAAI,CAAC2B,WAAD,EAAcC,cAAd,IAAgC5B,QAAQ,CAAC,EAAD,CAA5C;AACA,MAAI,CAAC6B,kBAAD,EAAqBC,qBAArB,IAA8C9B,QAAQ,CAAC,EAAD,CAA1D;AACA,MAAI,CAAC+B,OAAD,IAAY/B,QAAQ,CAAC,KAAD,CAAxB;AACA,MAAI,CAACgC,WAAD,EAAcC,cAAd,IAAgCjC,QAAQ,CAAC,EAAD,CAA5C;AACA,MAAI,CAACkC,YAAD,EAAeC,eAAf,IAAkCnC,QAAQ,CAAC,EAAD,CAA9C;AACA,MAAI,CAACoC,UAAD,EAAYC,aAAZ,IAA6BrC,QAAQ,EAAzC,CAfI,CAiBJ;;AACA,QAAMsC,gBAAgB,GAAIC,KAAD,IAAW;AAClCnB,IAAAA,OAAO,CAAC,IAAD,CAAP;AACAE,IAAAA,SAAS,CAACiB,KAAK,CAACC,YAAP,CAAT;AACAV,IAAAA,qBAAqB,CAACS,KAAK,CAACE,SAAP,CAArB;AACAN,IAAAA,eAAe,CAACI,KAAK,CAACG,UAAN,CAAiBC,QAAlB,CAAf;AACAf,IAAAA,cAAc,CACX,GAAEW,KAAK,CAACG,UAAN,CAAiBE,WAAjB,CAA6BC,SAAU,MAAKN,KAAK,CAACG,UAAN,CAAiBE,WAAjB,CAA6BE,SAAU,EAD1E,CAAd;AAGAT,IAAAA,aAAa,CAACE,KAAK,CAACG,UAAN,CAAiBK,cAAlB,CAAb,CARkC,CASlC;AACA;;AACA9B,IAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,UAASuB,KAAK,CAACE,SAAU,EAApD,EAAuDQ,EAAvD,CACE,OADF,EAEGC,QAAD,IAAc;AACZ,UAAIC,QAAQ,GAAGD,QAAQ,CAACE,GAAT,EAAf;AACA,UAAIC,aAAa,GAAGF,QAAQ,CAACG,OAA7B;AACArB,MAAAA,cAAc,CAACoB,aAAD,CAAd;AACD,KANH;AAQD,GAnBD;;AAqBA,QAAME,gBAAgB,GAAIhB,KAAD,IAAW;AAClCf,IAAAA,aAAa,CAACe,KAAK,CAACiB,MAAN,CAAaC,KAAd,CAAb;AACD,GAFD;;AAIA,QAAMC,YAAY,GAAInB,KAAD,IAAW;AAC9Bb,IAAAA,SAAS,CAACa,KAAK,CAACiB,MAAN,CAAaC,KAAd,CAAT;AACD,GAFD,CA3CI,CA8CJ;;;AACA,QAAME,WAAW,GAAG,MAAM;AACxBvC,IAAAA,OAAO,CAAC,KAAD,CAAP;AACD,GAFD,CA/CI,CAkDJ;;;AACA,QAAMwC,mBAAmB,GAAG,MAAM;AAChC,QAAIC,WAAW,GAAG;AAChBC,MAAAA,QAAQ,EAAE,IADM;AAEhBC,MAAAA,OAAO,EAAE,KAFO;AAGhBxC,MAAAA,UAAU,EAAEA,UAHI;AAIhBE,MAAAA,MAAM,EAAEA,MAJQ;AAKhBuC,MAAAA,MAAM,EAAE,IALQ;AAMhBC,MAAAA,QAAQ,EAAE;AANM,KAAlB;AAQA,QAAIC,WAAW,GAAG;AAChBJ,MAAAA,QAAQ,EAAE,IADM;AAEhBvC,MAAAA,UAAU,EAAEA,UAFI;AAGhBwC,MAAAA,OAAO,EAAE,IAHO;AAIhBtC,MAAAA,MAAM,EAAEA,MAJQ;AAKhBuC,MAAAA,MAAM,EAAE,IALQ;AAMhBC,MAAAA,QAAQ,EAAE;AANM,KAAlB;;AAQA,QAAI1C,UAAU,KAAK,KAAnB,EAA0B;AACxB;AACAN,MAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,UAASa,kBAAmB,EAAvD,EAA0DsC,MAA1D,CAAiE;AAC/Db,QAAAA,OAAO,EAAEc,MAAM,CAACpC,WAAD,CAAN,GAAsBoC,MAAM,CAAC3C,MAAD,CAA5B,GAAqCW;AADiB,OAAjE,EAFwB,CAKxB;;AACAnB,MAAAA,EAAE,CAAC+B,GAAH,CACG,iBAAgBhC,EAAG,UAASa,kBAAmB,YAAWK,YAAa,EAD1E,EAEEiC,MAFF,CAESN,WAFT,EANwB,CASxB;;AACA5C,MAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,gBAAeK,MAAO,EAAjD,EAAoD8C,MAApD,CAA2DN,WAA3D;AACArC,MAAAA,aAAa,CAAC,EAAD,CAAb;AACAE,MAAAA,SAAS,CAAC,EAAD,CAAT;AACAiC,MAAAA,WAAW;AACZ,KAdD,MAcO;AACL;AACA1C,MAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,gBAAeK,MAAO,EAAjD,EAAoD8C,MAApD,CAA2DD,WAA3D,EAFK,CAGL;;AACAjD,MAAAA,EAAE,CAAC+B,GAAH,CACG,iBAAgBhC,EAAG,UAASa,kBAAmB,YAAWK,YAAa,EAD1E,EAEEiC,MAFF,CAESD,WAFT;AAIAP,MAAAA,WAAW;AACXnC,MAAAA,aAAa,CAAC,EAAD,CAAb;AACAE,MAAAA,SAAS,CAAC,EAAD,CAAT;AACD;AACF,GA3CD;;AA6CA,QAAM2C,kBAAkB,GAAI9B,KAAD,IAAW;AACpCtB,IAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,gBAAeuB,KAAK,CAACC,YAAa,EAA7D,EAAgE2B,MAAhE,CAAuE;AACrEG,MAAAA,OAAO,EAAE;AAD4D,KAAvE;AAGArD,IAAAA,EAAE,CAAC+B,GAAH,CACG,iBAAgBhC,EAAG,UAASuB,KAAK,CAACE,SAAU,YAAWF,KAAK,CAACG,UAAN,CAAiBC,QAAS,EADpF,EAEEwB,MAFF,CAES;AACPG,MAAAA,OAAO,EAAE;AADF,KAFT;AAKD,GATD,CAhGI,CA2GJ;;;AACA,QAAMC,sBAAsB,GAAIhC,KAAD,IAAW;AAExCtB,IAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,gBAAeuB,KAAK,CAACC,YAAa,EAA7D,EAAgE2B,MAAhE,CAAuE;AACrEG,MAAAA,OAAO,EAAE;AAD4D,KAAvE;AAGArD,IAAAA,EAAE,CAAC+B,GAAH,CACG,iBAAgBhC,EAAG,UAASuB,KAAK,CAACE,SAAU,YAAWF,KAAK,CAACG,UAAN,CAAiBC,QAAS,EADpF,EAEEwB,MAFF,CAES;AACPG,MAAAA,OAAO,EAAE;AADF,KAFT;AAKD,GAVD,CA5GI,CAwHJ;;;AACA,QAAME,eAAe,GAAGpE,WAAW,CAAEqE,KAAD,IAAW;AAC7C,WAAOA,KAAK,CAACC,WAAN,CAAkBC,QAAzB;AACD,GAFkC,CAAnC,CAzHI,CA4HJ;;AACA,QAAMC,gBAAgB,GAAGxE,WAAW,CAAEqE,KAAD,IAAW;AAC9C,WAAOA,KAAP;AACD,GAFmC,CAApC,CA7HI,CAiIJ;;AACA,QAAMI,kBAAkB,GAAItC,KAAD,IAAW;AACpC,UAAMuC,aAAa,GAAGvC,KAAK,CAACd,MAA5B;AACA,UAAMsD,UAAU,GAAG;AACjBjB,MAAAA,QAAQ,EAAE,KADO;AAEjBC,MAAAA,OAAO,EAAE,KAFQ;AAGjBxC,MAAAA,UAAU,EAAE,EAHK;AAIjBE,MAAAA,MAAM,EAAE;AAJS,KAAnB;AAMA+C,IAAAA,eAAe,CAACQ,MAAhB,CAAwB5B,GAAD,IAAS;AAC9B,UAAIA,GAAG,CAACpC,EAAJ,KAAWuB,KAAK,CAACE,SAArB,EAAgC;AAC9B,YAAIwC,SAAS,GAAG7B,GAAG,CAACE,OAApB;AACArC,QAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,UAASuB,KAAK,CAACE,SAAU,EAApD,EAAuD0B,MAAvD,CAA8D;AAC5Db,UAAAA,OAAO,EAAE2B,SAAS,IAAIb,MAAM,CAACU,aAAD,CAAN,GAAuBvC,KAAK,CAACG,UAAN,CAAiBK,cAA5C;AAD0C,SAA9D;AAGA9B,QAAAA,EAAE,CAAC+B,GAAH,CACG,iBAAgBhC,EAAG,UAASuB,KAAK,CAACE,SAAU,YAAWF,KAAK,CAACG,UAAN,CAAiBC,QAAS,EADpF,EAEEwB,MAFF,CAESY,UAFT;AAGA9D,QAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,gBAAeuB,KAAK,CAACC,YAAa,EAA7D,EAAgE2B,MAAhE,CACEY,UADF;AAGD;AACF,KAbD;AAcD,GAtBD,CAlII,CA0JJ;;;AACA,QAAMG,uBAAuB,GAAI3C,KAAD,IAAW;AACzCtB,IAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,gBAAeuB,KAAK,CAACC,YAAa,EAA7D,EAAgE2B,MAAhE,CAAuE;AACrEF,MAAAA,QAAQ,EAAE;AAD2D,KAAvE,EADyC,CAKzC;AACD,GAND,CA3JI,CAmKJ;;;AACA,QAAMkB,wBAAwB,GAAI5C,KAAD,IAAW;AAC1C,UAAMuC,aAAa,GAAGvC,KAAK,CAACd,MAA5B;AACA,UAAMsD,UAAU,GAAG;AACjBjB,MAAAA,QAAQ,EAAE,KADO;AAEjBvC,MAAAA,UAAU,EAAE,EAFK;AAGjBwC,MAAAA,OAAO,EAAE,KAHQ;AAIjBtC,MAAAA,MAAM,EAAE,EAJS;AAKjBwC,MAAAA,QAAQ,EAAE,IALO;AAMjBmB,MAAAA,YAAY,EAAE,IANG;AAOjBpB,MAAAA,MAAM,EAAE;AAPS,KAAnB;AASAQ,IAAAA,eAAe,CAACQ,MAAhB,CAAwB5B,GAAD,IAAS;AAC9B;AACA,UAAIA,GAAG,CAACpC,EAAJ,KAAWuB,KAAK,CAACE,SAArB,EAAgC;AAC9B,YAAIwC,SAAS,GAAG7B,GAAG,CAACE,OAApB,CAD8B,CAE9B;;AACArC,QAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,UAASuB,KAAK,CAACE,SAAU,EAApD,EAAuD0B,MAAvD,CAA8D;AAC5Db,UAAAA,OAAO,EACL2B,SAAS,IAAIb,MAAM,CAACU,aAAD,CAAN,GAAwBV,MAAM,CAACU,aAAD,CAA9B,GAAgD,CAApD;AAFiD,SAA9D,EAH8B,CAO9B;;AACA7D,QAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,gBAAeuB,KAAK,CAACC,YAAa,EAA7D,EACG2B,MADH,CACUY,UADV,EAEGM,IAFH,CAEQ,MAAM;AACVT,UAAAA,gBAAgB,CAACU,WAAjB,CAA6BC,QAA7B,CAAsCP,MAAtC,CAA8CQ,IAAD,IAAU;AACrD,gBAAIA,IAAI,CAACxE,EAAL,KAAYuB,KAAK,CAACkD,UAAtB,EAAkC;AAChC;AACAnF,cAAAA,IAAI,EACF;AACA;AACA,+BAHE,EAIF,kBAJE,EAKF;AACEoF,gBAAAA,EAAE,EAAEF,IAAI,CAACG,KADX;AAEEC,gBAAAA,OAAO,EAAG,GAAErD,KAAK,CAACsD,QAAS,EAF7B;AAGEC,gBAAAA,eAAe,EAAE,OAHnB;AAIEC,gBAAAA,OAAO,EAAE,EAJX;AAKEC,gBAAAA,OAAO,EAAG,8DALZ;AAMEC,gBAAAA,IAAI,EAAE,iBANR;AAOEC,gBAAAA,QAAQ,EAAE;AAPZ,eALE,EAcFC,OAAO,CAACC,GAAR,CAAYC,0BAdV,CAAJ,CAgBGhB,IAhBH,CAgBQ,MAAM;AACViB,gBAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACD,eAlBH,EAmBGC,KAnBH,CAmBUC,GAAD,IAAS;AACdH,gBAAAA,OAAO,CAACC,GAAR,CAAY,+BAAZ,EAA6CE,GAA7C;AACD,eArBH;AAsBD;AACF,WA1BD;AA2BD,SA9BH;AAgCAxF,QAAAA,EAAE,CAAC+B,GAAH,CACG,iBAAgBhC,EAAG,UAASuB,KAAK,CAACE,SAAU,YAAWF,KAAK,CAACG,UAAN,CAAiBC,QAAS,EADpF,EAEEwB,MAFF,CAESY,UAFT,EAxC8B,CA2C9B;;AACA9D,QAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,UAASuB,KAAK,CAACC,YAAa,EAAvD,EAA0DkE,MAA1D;AACAzF,QAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,aAAYuB,KAAK,CAACC,YAAa,EAA1D,EAA6DkE,MAA7D;AACD;AACF,KAjDD;AAkDD,GA7DD,CApKI,CAmOJ;;;AACA,QAAMC,mBAAmB,GAAIpE,KAAD,IAAW;AACrCtB,IAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,gBAAeuB,KAAK,CAACC,YAAa,EAA7D,EAAgE2B,MAAhE,CAAuE;AACrEiB,MAAAA,YAAY,EAAE;AADuD,KAAvE;AAGAnE,IAAAA,EAAE,CAAC+B,GAAH,CACG,iBAAgBhC,EAAG,UAASuB,KAAK,CAACE,SAAU,YAAWF,KAAK,CAACG,UAAN,CAAiBC,QAAS,EADpF,EAEEwB,MAFF,CAES;AACPiB,MAAAA,YAAY,EAAE;AADP,KAFT;AAKD,GATD,CApOI,CA+OJ;;;AACA,MAAI,CAACwB,MAAD,EAASC,SAAT,IAAsB7G,QAAQ,CAAC,EAAD,CAAlC;AACA,MAAI,CAAC8G,OAAD,EAAUC,UAAV,IAAwB/G,QAAQ,CAAC,KAAD,CAApC;;AACA,QAAMgH,cAAc,GAAIzE,KAAD,IAAW;AAChCsE,IAAAA,SAAS,CAACtE,KAAD,CAAT;AACAwE,IAAAA,UAAU,CAAC,IAAD,CAAV;AACD,GAHD;;AAIA,QAAME,cAAc,GAAG,MAAM;AAC3BF,IAAAA,UAAU,CAAC,KAAD,CAAV;AACAF,IAAAA,SAAS,CAAC,EAAD,CAAT;AACD,GAHD,CAtPI,CA2PJ;;;AAEAxG,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI6G,gBAAgB,GAAGC,WAAW,CAAC,MAAM;AACvC,UAAI3G,QAAQ,CAAC4G,MAAb,EAAqB;AACnB;AACA5G,QAAAA,QAAQ,CAACwE,MAAT,CAAiB5B,GAAD,IAAS;AACvB,cACE,CAACA,GAAG,CAACa,QAAL,IACA,CAACb,GAAG,CAACkB,OADL,IAEA,CAAClB,GAAG,CAACgC,YAFL,IAGA,CAAChC,GAAG,CAACW,OAHL,IAIAX,GAAG,CAACY,MAJJ,IAKA,CAACZ,GAAG,CAACU,QANP,EAOE;AACA,kBAAMuD,QAAQ,GAAGjE,GAAG,CAACV,UAAJ,CAAeE,WAAhC;AACA,gBAAI0E,YAAY,GAAG,IAAIC,IAAJ,CAASnE,GAAG,CAACV,UAAJ,CAAe8E,aAAxB,CAAnB;AACA,gBAAIC,OAAO,GAAG,IAAIF,IAAJ,CAASD,YAAT,CAAd;AACA,gBAAII,WAAW,GAAG,IAAIH,IAAJ,EAAlB;AACAE,YAAAA,OAAO,CAACE,OAAR,CAAgBF,OAAO,CAACG,OAAR,KAAoBxD,MAAM,CAACiD,QAAQ,CAACQ,YAAV,CAA1C;AACA,gBAAIC,iBAAiB,GAAGC,IAAI,CAACC,KAAL,CACtBD,IAAI,CAACE,MAAL,MACG7D,MAAM,CAACiD,QAAQ,CAACvE,SAAV,CAAN,GACCsB,MAAM,CAACiD,QAAQ,CAACxE,SAAV,CADP,GAECuB,MAAM,CAACiD,QAAQ,CAACxE,SAAV,CAHV,CADsB,CAAxB;;AAMA,gBAAI6E,WAAW,CAACQ,OAAZ,MAAyBT,OAAO,CAACS,OAAR,EAA7B,EAAgD;AAC9C,oBAAMC,cAAc,GAAG3D,eAAe,CAACQ,MAAhB,CACpBQ,IAAD,IAAUA,IAAI,CAACxE,EAAL,KAAYoC,GAAG,CAACX,SADL,CAAvB;AAGA,oBAAM2F,WAAW,GAAG;AAClBtE,gBAAAA,QAAQ,EAAE,IADQ;AAElBC,gBAAAA,OAAO,EAAE,KAFS;AAGlBxC,gBAAAA,UAAU,EAAE,KAHM;AAIlBE,gBAAAA,MAAM,EAAEqG,iBAJU;AAKlB9D,gBAAAA,MAAM,EAAE,IALU;AAMlBC,gBAAAA,QAAQ,EAAE;AANQ,eAApB;AAQAhD,cAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,UAASoC,GAAG,CAACX,SAAU,EAAlD,EAAqD0B,MAArD,CAA4D;AAC1Db,gBAAAA,OAAO,EAAE6E,cAAc,CAAC,CAAD,CAAd,CAAkB7E,OAAlB,GAA4BwE,iBAA5B,GAA+C1E,GAAG,CAACV,UAAJ,CAAeK;AADb,eAA5D;AAGA9B,cAAAA,EAAE,CAAC+B,GAAH,CACG,iBAAgBhC,EAAG,UAASoC,GAAG,CAACX,SAAU,YAAWW,GAAG,CAACV,UAAJ,CAAeC,QAAS,EADhF,EAEEwB,MAFF,CAESiE,WAFT;AAGAnH,cAAAA,EAAE,CAAC+B,GAAH,CAAQ,iBAAgBhC,EAAG,gBAAeoC,GAAG,CAACZ,YAAa,EAA3D,EACG2B,MADH,CACUiE,WADV,EAEG/C,IAFH,CAEQ,MAAM;AACViB,gBAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACD,eAJH;AAKAD,cAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAmBnD,GAAnB;AACD;AACF,WA5CD,CA6CA;AA7CA,eA8CK,IACHA,GAAG,CAACa,QAAJ,IACA,CAACb,GAAG,CAACkB,OADL,IAEA,CAAClB,GAAG,CAACgC,YAFL,IAGA,CAAChC,GAAG,CAACW,OAHL,IAIAX,GAAG,CAACY,MAJJ,IAKA,CAACZ,GAAG,CAACU,QANF,EAOH;AACA;AAEA,kBAAMuD,QAAQ,GAAGjE,GAAG,CAACV,UAAJ,CAAeE,WAAhC,CAHA,CAIA;;AACA,gBAAI0E,YAAY,GAAG,IAAIC,IAAJ,CAASnE,GAAG,CAACV,UAAJ,CAAe8E,aAAxB,CAAnB;AACA,gBAAIC,OAAO,GAAG,IAAIF,IAAJ,CAASD,YAAT,CAAd;AACA,gBAAII,WAAW,GAAG,IAAIH,IAAJ,EAAlB;AACAE,YAAAA,OAAO,CAACE,OAAR,CAAgBF,OAAO,CAACG,OAAR,KAAoBxD,MAAM,CAACiD,QAAQ,CAACQ,YAAV,CAA1C,EARA,CASA;;AACA,gBAAIH,WAAW,CAACQ,OAAZ,MAAyBT,OAAO,CAACS,OAAR,EAA7B,EAAgD;AAC9C;AACAjH,cAAAA,EAAE,CAAC+B,GAAH,CACG,iBAAgBhC,EAAG,gBAAeoC,GAAG,CAACZ,YAAa,EADtD,EAEE2B,MAFF,CAES;AACPG,gBAAAA,OAAO,EAAE,IADF;AAEPN,gBAAAA,MAAM,EAAE,KAFD;AAGPC,gBAAAA,QAAQ,EAAE;AAHH,eAFT;AAOAhD,cAAAA,EAAE,CAAC+B,GAAH,CACG,iBAAgBhC,EAAG,UAASoC,GAAG,CAACX,SAAU,YAAWW,GAAG,CAACV,UAAJ,CAAeC,QAAS,EADhF,EAEEwB,MAFF,CAES;AACPG,gBAAAA,OAAO,EAAE,IADF;AAEPN,gBAAAA,MAAM,EAAE,KAFD;AAGPC,gBAAAA,QAAQ,EAAE;AAHH,eAFT;AAOD;AACF;AACF,SAlFD;AAmFD;AACF,KAvFiC,EAuF/B,KAvF+B,CAAlC;AAwFA,WAAO,MAAM;AACXoE,MAAAA,aAAa,CAACnB,gBAAD,CAAb;AACD,KAFD;AAGD,GA5FQ,CAAT;;AA8FA,MAAI,CAAC1G,QAAQ,CAAC4G,MAAd,EAAsB;AACpB,wBAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAP;AACD,GA7VG,CA8VJ;;;AAEA,sBACE;AAAK,IAAA,SAAS,EAAC,iBAAf;AAAA,4BAEE,QAAC,YAAD;AACE,MAAA,IAAI,EAAEjG,IADR;AAEE,MAAA,eAAe,EAAEmB,gBAFnB;AAGE,MAAA,YAAY,EAAEiB,gBAHhB;AAIE,MAAA,gBAAgB,EAAEG,YAJpB;AAKE,MAAA,UAAU,EAAEjC,MALd;AAME,MAAA,QAAQ,EAAC,UANX;AAOE,MAAA,UAAU,EAAC,QAPb;AAQE,MAAA,KAAK,EAAEE,WART;AASE,MAAA,iBAAiB,EAAEiC,mBATrB;AAUE,MAAA,WAAW,EAAED,WAVf;AAWE,MAAA,OAAO,EAAE5B;AAXX;AAAA;AAAA;AAAA;AAAA,YAFF,eAgBE,QAAC,YAAD;AACE,MAAA,eAAe,EAAEiF,cADnB;AAEE,MAAA,MAAM,EAAEJ,MAFV;AAGE,MAAA,IAAI,EAAEE,OAHR;AAIE,MAAA,QAAQ,EAAC,OAJX;AAKE,MAAA,WAAW,EAAEG;AALf;AAAA;AAAA;AAAA;AAAA,YAhBF,eAuBE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA,6BACE;AAAO,QAAA,SAAS,EAAC,aAAjB;AAAA,gCACE;AAAA,iCACE;AAAA,oCACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAFF,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAHF,eAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAJF,eAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBALF,eAME;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBANF,eAOE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAPF,EASG,CAACxG,GAAD,gBAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAP,GAA0B,IAT7B;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBADF,eAcE;AAAA,oBACGD,QAAQ,CAAC8H,GAAT,CAAclF,GAAD,IAAS;AACrB,gBAAImF,aAAa,GAAG,IAAIhB,IAAJ,CAASnE,GAAG,CAACV,UAAJ,CAAe8E,aAAxB,CAApB;AACA,kBAAMgB,iBAAiB,GAAG,IAAIjB,IAAJ,CAASnE,GAAG,CAACqF,UAAb,CAA1B;AACA,kBAAMC,aAAa,GAAGH,aAAa,CAACL,OAAd,EAAtB;AACA,kBAAMS,UAAU,GAAGH,iBAAiB,CAACN,OAAlB,EAAnB;AACA,kBAAMU,UAAU,GAAG,OAAO,IAAP,GAAc,EAAjC;AACA,kBAAMC,gBAAgB,GACpB,CAACF,UAAU,GAAGD,aAAd,IAA+BE,UADjC;AAEA,gCACE;AAAA,sCACE;AAAA,uCACE;AACE,kBAAA,SAAS,EAAC,WADZ;AAEE,kBAAA,GAAG,EAAExF,GAAG,CAAC0F,YAFX;AAGE,kBAAA,GAAG,EAAC,KAHN;AAIE,kBAAA,OAAO,EAAE,MAAM9B,cAAc,CAAC5D,GAAG,CAAC0F,YAAL;AAJ/B;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,sBADF,eASE;AAAA,0BAAK1F,GAAG,CAACV,UAAJ,CAAeE,WAAf,CAA2BmG;AAAhC;AAAA;AAAA;AAAA;AAAA,sBATF,eAUE;AAAA,0BAAK3F,GAAG,CAACyC;AAAT;AAAA;AAAA;AAAA;AAAA,sBAVF,eAWE;AAAA,2BAAKzC,GAAG,CAACV,UAAJ,CAAeE,WAAf,CAA2BiF,YAAhC;AAAA;AAAA;AAAA;AAAA;AAAA,sBAXF,eAYE;AAAA,0BACGgB,gBAAgB,GAAGzF,GAAG,CAACV,UAAJ,CAAeE,WAAf,CAA2BiF,YAA9C,GACG,MADH,GAEG;AAHN;AAAA;AAAA;AAAA;AAAA,sBAZF,eAiBE;AAAA,0BAAKzE,GAAG,CAACV,UAAJ,CAAeE,WAAf,CAA2BoG;AAAhC;AAAA;AAAA;AAAA;AAAA,sBAjBF,eAkBE;AAAA,0BAAM,GAAE5F,GAAG,CAACV,UAAJ,CAAeE,WAAf,CAA2BC,SAAU,MAAKO,GAAG,CAACV,UAAJ,CAAeE,WAAf,CAA2BE,SAAU;AAAvF;AAAA;AAAA;AAAA;AAAA,sBAlBF,eAmBE;AAAI,gBAAA,SAAS,EAAC,cAAd;AAAA,2BACG,CAACrC,GAAD,gBACC;AAAQ,kBAAA,OAAO,EAAE,MAAM6B,gBAAgB,CAACc,GAAD,CAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADD,GAIG,IALN,EAMG,CAACzC,UAAD,GACC,CAACD,QAAD,gBACE;AACE,kBAAA,SAAS,EAAC,YADZ;AAEE,kBAAA,OAAO,EAAE,MAAM2D,kBAAkB,CAACjB,GAAD,CAFnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADF,gBAQE;AACE,kBAAA,SAAS,EAAC,YADZ;AAEE,kBAAA,OAAO,EACL,CAACxC,YAAD,GACI,MAAM2D,sBAAsB,CAACnB,GAAD,CADhC,GAEI,MAAMyB,kBAAkB,CAACzB,GAAD,CALhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBATH,GAoBG,IA1BN,EA4BGvC,kBAAkB,gBACjB;AACE,kBAAA,SAAS,EAAC,YADZ;AAEE,kBAAA,OAAO,EAAE,MAAMsE,wBAAwB,CAAC/B,GAAD,CAFzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADiB,GAOf,IAnCN,EAoCGtC,eAAe,gBACd;AACE,kBAAA,SAAS,EAAC,YADZ;AAEE,kBAAA,OAAO,EAAE,MAAMoE,uBAAuB,CAAC9B,GAAD,CAFxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADc,GAOZ,IA3CN,EA4CGrC,QAAQ,gBACP;AACE,kBAAA,SAAS,EAAC,YADZ;AAEE,kBAAA,OAAO,EAAE,MAAM4F,mBAAmB,CAACvD,GAAD,CAFpC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADO,GAOL,IAnDN;AAAA;AAAA;AAAA;AAAA;AAAA,sBAnBF;AAAA,eAASA,GAAG,CAACZ,YAAb;AAAA;AAAA;AAAA;AAAA,oBADF;AA2ED,WAnFA;AADH;AAAA;AAAA;AAAA;AAAA,gBAdF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YAvBF;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AAiID,CA1eD;;GAAMjC,gB;UAWWL,S,EAuHSE,W,EAICA,W;;;KAtIrBG,gB;AA4eN,eAAeA,gBAAf","sourcesContent":["import React, { useState } from \"react\";\nimport firebase from \"../../../../Config/FirebaseConfig\";\nimport { useParams } from \"react-router-dom\";\nimport ApprovedForm from \"./ApprovedForm\";\nimport { useSelector } from \"react-redux\";\nimport { useEffect } from \"react\";\nimport { send } from \"emailjs-com\";\n\nconst SubmitGoalsTable = ({\n  selector,\n  btn,\n  undoFunc,\n  declineBtn,\n  approvedUndo,\n  declineForReported,\n  undoForReported,\n  undoFake,\n}) => {\n  // const history = useHistory();\n  const { id } = useParams();\n  const db = firebase.database();\n\n  // approved form working\n  let [open, setOpen] = useState(false);\n  let [goalId, setGoalId] = useState(\"\");\n  let [percantage, setPercentage] = useState(\"\");\n  let [reward, setReward] = useState(\"\");\n  let [rewardRange, setRewardRange] = useState(\"\");\n  let [organizationUserId, setOrganizationUserId] = useState(\"\");\n  let [loading] = useState(false);\n  let [userBalance, setUserBalance] = useState(\"\");\n  let [userMyGoalId, setUserMyGoalId] = useState(\"\");\n  let [userInvest,setUserInvest] = useState()\n\n  // working for approved form\n  const openApprovedForm = (event) => {\n    setOpen(true);\n    setGoalId(event.submitGoalId);\n    setOrganizationUserId(event.orgUserId);\n    setUserMyGoalId(event.SubmitGoal.myGoalId);\n    setRewardRange(\n      `${event.SubmitGoal.inputValues.rewardMin} - ${event.SubmitGoal.inputValues.rewardMax}`\n    );\n    setUserInvest(event.SubmitGoal.userInvestment)\n    // console.log(event)\n    // get organization user info to get prev balance\n    db.ref(`organizations/${id}/users/${event.orgUserId}`).on(\n      \"value\",\n      (snapshot) => {\n        let userData = snapshot.val();\n        let userBalancedb = userData.balance;\n        setUserBalance(userBalancedb);\n      }\n    );\n  };\n\n  const handlePercentage = (event) => {\n    setPercentage(event.target.value);\n  };\n\n  const handleReward = (event) => {\n    setReward(event.target.value);\n  };\n  // form close function\n  const handleClose = () => {\n    setOpen(false);\n  };\n  // goals approved function\n  const handleApprovedGoals = () => {\n    let approveData = {\n      approved: true,\n      pending: false,\n      percantage: percantage,\n      reward: reward,\n      submit: true,\n      isReport: false,\n    };\n    let pendingData = {\n      approved: true,\n      percantage: percantage,\n      pending: true,\n      reward: reward,\n      submit: true,\n      isReport: false,\n    };\n    if (percantage === \"100\") {\n      // add  balance in user acount\n      db.ref(`organizations/${id}/users/${organizationUserId}`).update({\n        balance: Number(userBalance) + Number(reward)+userInvest ,\n      });\n      // update goal status in users goal ref\n      db.ref(\n        `organizations/${id}/users/${organizationUserId}/myGoals/${userMyGoalId}`\n      ).update(approveData);\n      // update goal data in submit goal ref \n      db.ref(`organizations/${id}/submitGoals/${goalId}`).update(approveData);\n      setPercentage(\"\");\n      setReward(\"\");\n      handleClose();\n    } else {\n      // update goal data in submit goal ref \n      db.ref(`organizations/${id}/submitGoals/${goalId}`).update(pendingData);\n      // add  balance in user acount\n      db.ref(\n        `organizations/${id}/users/${organizationUserId}/myGoals/${userMyGoalId}`\n      ).update(pendingData);\n\n      handleClose();\n      setPercentage(\"\");\n      setReward(\"\");\n    }\n  };\n\n  const handleDeclineGoals = (event) => {\n    db.ref(`organizations/${id}/submitGoals/${event.submitGoalId}`).update({\n      decline: true,\n    });\n    db.ref(\n      `organizations/${id}/users/${event.orgUserId}/myGoals/${event.SubmitGoal.myGoalId}`\n    ).update({\n      decline: true,\n    });\n  };\n\n  // goals undo decline function \n  const handleUndoDeclineGoals = (event) => {\n  \n    db.ref(`organizations/${id}/submitGoals/${event.submitGoalId}`).update({\n      decline: false,\n    });\n    db.ref(\n      `organizations/${id}/users/${event.orgUserId}/myGoals/${event.SubmitGoal.myGoalId}`\n    ).update({\n      decline: false,\n    });\n  };\n\n  // get user total balance\n  const balanceSelector = useSelector((state) => {\n    return state.goalReducer.orgUsers;\n  });\n  // get all users of organization \n  const allUsersSelector = useSelector((state) => {\n    return state;\n  });\n\n  // approved undo function\n  const handleApprovedUndo = (event) => {\n    const getPrevReward = event.reward;\n    const updateData = {\n      approved: false,\n      pending: false,\n      percantage: \"\",\n      reward: \"\",\n    };\n    balanceSelector.filter((val) => {\n      if (val.id === event.orgUserId) {\n        let userBlnce = val.balance;\n        db.ref(`organizations/${id}/users/${event.orgUserId}`).update({\n          balance: userBlnce - (Number(getPrevReward)+ event.SubmitGoal.userInvestment ),\n        });\n        db.ref(\n          `organizations/${id}/users/${event.orgUserId}/myGoals/${event.SubmitGoal.myGoalId}`\n        ).update(updateData);\n        db.ref(`organizations/${id}/submitGoals/${event.submitGoalId}`).update(\n          updateData\n        );\n      }\n    });\n  };\n\n  // undo reported goal\n  const handleUndoReportedGoals = (event) => {\n    db.ref(`organizations/${id}/submitGoals/${event.submitGoalId}`).update({\n      isReport: false,\n    });\n\n    // console.log(event)\n  };\n\n  // accept reporting request if any user is  reported goal\n  const handleDeclineReportGoals = (event) => {\n    const getPrevReward = event.reward;\n    const updateData = {\n      approved: false,\n      percantage: \"\",\n      pending: false,\n      reward: \"\",\n      isReport: true,\n      acceptReport: true,\n      submit: false,\n    };\n    balanceSelector.filter((val) => {\n      // console.log(val,event)\n      if (val.id === event.orgUserId) {\n        let userBlnce = val.balance;\n        //  balance minus from total balance\n        db.ref(`organizations/${id}/users/${event.orgUserId}`).update({\n          balance:\n            userBlnce - (Number(getPrevReward) ? Number(getPrevReward) : 0),\n        });\n        // back to initial state\n        db.ref(`organizations/${id}/submitGoals/${event.submitGoalId}`)\n          .update(updateData)\n          .then(() => {\n            allUsersSelector.userReducer.allUsers.filter((user) => {\n              if (user.id === event.userIdMain) {\n                // console.log(user)\n                send(\n                  // process.env.REACT_APP_EMAIL_JS_SERVICE_ID,\n                  // process.env.REACT_APP_EMAIL_JS_TEMPLATE_ID,\n                  \"service_q1galup\",\n                  \"template_aq5fbiv\",\n                  {\n                    to: user.email,\n                    to_name: `${event.userName}`,\n                    from_email_name: \"TRYVE\",\n                    subject: \"\",\n                    message: `TRYVE reported your goal please retake good picture. Thanks!`,\n                    from: \"tryve@gmail.com\",\n                    reply_to: \"tryve@gmail.com\",\n                  },\n                  process.env.REACT_APP_EMAIL_JS_USER_ID\n                )\n                  .then(() => {\n                    console.log(\"success...\");\n                  })\n                  .catch((err) => {\n                    console.log(\"admin Email sending FAILED...\", err);\n                  });\n              }\n            });\n          });\n\n        db.ref(\n          `organizations/${id}/users/${event.orgUserId}/myGoals/${event.SubmitGoal.myGoalId}`\n        ).update(updateData);\n        // remove all likes of goal\n        db.ref(`organizations/${id}/likes/${event.submitGoalId}`).remove();\n        db.ref(`organizations/${id}/comments/${event.submitGoalId}`).remove();\n      }\n    });\n  };\n\n  // undo fake goals\n  const handleUndoFakeGoals = (event) => {\n    db.ref(`organizations/${id}/submitGoals/${event.submitGoalId}`).update({\n      acceptReport: false,\n    });\n    db.ref(\n      `organizations/${id}/users/${event.orgUserId}/myGoals/${event.SubmitGoal.myGoalId}`\n    ).update({\n      acceptReport: false,\n    });\n  };\n\n  // submit goal image function\n  let [imgUrl, setImgUrl] = useState(\"\");\n  let [showImg, setShowImg] = useState(false);\n  const handleSeeImage = (event) => {\n    setImgUrl(event);\n    setShowImg(true);\n  };\n  const handleCloseImg = () => {\n    setShowImg(false);\n    setImgUrl(\"\");\n  };\n\n  // automatically approved working\n\n  useEffect(() => {\n    let approvedinterVal = setInterval(() => {\n      if (selector.length) {\n        // let filterDataForApproved =\n        selector.filter((val) => {\n          if (\n            !val.isReport &&\n            !val.decline &&\n            !val.acceptReport &&\n            !val.pending &&\n            val.submit &&\n            !val.approved\n          ) {\n            const inputVal = val.SubmitGoal.inputValues;\n            let getStartDate = new Date(val.SubmitGoal.GoalStartDate);\n            let endDate = new Date(getStartDate);\n            let currentDate = new Date();\n            endDate.setDate(endDate.getDate() + Number(inputVal.numberOfDays));\n            let randomNumGenerate = Math.floor(\n              Math.random() *\n                (Number(inputVal.rewardMax) -\n                  Number(inputVal.rewardMin) +\n                  Number(inputVal.rewardMin))\n            );\n            if (currentDate.getTime() >= endDate.getTime()) {\n              const filterGoalUser = balanceSelector.filter(\n                (user) => user.id === val.orgUserId\n              );\n              const approvedObj = {\n                approved: true,\n                pending: false,\n                percantage: \"100\",\n                reward: randomNumGenerate,\n                submit: true,\n                isReport: false,\n              };\n              db.ref(`organizations/${id}/users/${val.orgUserId}`).update({\n                balance: filterGoalUser[0].balance + randomNumGenerate +val.SubmitGoal.userInvestment ,\n              });\n              db.ref(\n                `organizations/${id}/users/${val.orgUserId}/myGoals/${val.SubmitGoal.myGoalId}`\n              ).update(approvedObj);\n              db.ref(`organizations/${id}/submitGoals/${val.submitGoalId}`)\n                .update(approvedObj)\n                .then(() => {\n                  console.log(\"auto approved\");\n                });\n              console.log(\"end\", val);\n            }\n          }\n          // if goals is reported and not approved not pending only submit and someone reported then is would be decline autt\n          else if (\n            val.isReport &&\n            !val.decline &&\n            !val.acceptReport &&\n            !val.pending &&\n            val.submit &&\n            !val.approved\n          ) {\n            // console.log(val)\n\n            const inputVal = val.SubmitGoal.inputValues;\n            // let getSubmitDate = new Date(val.submitDate);\n            let getStartDate = new Date(val.SubmitGoal.GoalStartDate);\n            let endDate = new Date(getStartDate);\n            let currentDate = new Date();\n            endDate.setDate(endDate.getDate() + Number(inputVal.numberOfDays));\n            // console.log(currentDate.getTime() , endDate.getTime())\n            if (currentDate.getTime() >= endDate.getTime()) {\n              // console.log('is report', val)\n              db.ref(\n                `organizations/${id}/submitGoals/${val.submitGoalId}`\n              ).update({\n                decline: true,\n                submit: false,\n                isReport: false,\n              });\n              db.ref(\n                `organizations/${id}/users/${val.orgUserId}/myGoals/${val.SubmitGoal.myGoalId}`\n              ).update({\n                decline: true,\n                submit: false,\n                isReport: false,\n              });\n            }\n          }\n        });\n      }\n    }, 10000);\n    return () => {\n      clearInterval(approvedinterVal);\n    };\n  });\n\n  if (!selector.length) {\n    return <div>no goals</div>;\n  }\n  // console.log(selector);\n\n  return (\n    <div className=\"table_container\">\n      {/* approve form popup  */}\n      <ApprovedForm\n        open={open}\n        handleClickOpen={openApprovedForm}\n        handleSelect={handlePercentage}\n        handleInputvalue={handleReward}\n        inputValue={reward}\n        btnValue=\"Approved\"\n        labelValue=\"Reward\"\n        range={rewardRange}\n        handleAddFunction={handleApprovedGoals}\n        handleClose={handleClose}\n        loading={loading}\n      />\n      {/* image show popup  */}\n      <ApprovedForm\n        handleClickOpen={handleSeeImage}\n        imgUrl={imgUrl}\n        open={showImg}\n        btnValue=\"Close\"\n        handleClose={handleCloseImg}\n      />\n      <div className=\"table_md\">\n        <table className=\"goals_table\">\n          <thead>\n            <tr>\n              <th>Image</th>\n              <th>Name</th>\n              <th>People Joined</th>\n              <th>Time Limit</th>\n              <th>Status</th>\n              <th>category</th>\n              <th>Reward Range</th>\n\n              {!btn ? <th>Actions</th> : null}\n            </tr>\n          </thead>\n          <tbody>\n            {selector.map((val) => {\n              let goalStartDate = new Date(val.SubmitGoal.GoalStartDate);\n              const newDateForEndDate = new Date(val.submitDate);\n              const goalStartTime = goalStartDate.getTime();\n              const getEndTime = newDateForEndDate.getTime();\n              const oneDayTime = 1000 * 3600 * 24;\n              const takeNumberOfDays =\n                (getEndTime - goalStartTime) / oneDayTime;\n              return (\n                <tr key={val.submitGoalId}>\n                  <td>\n                    <img\n                      className=\"goals_img\"\n                      src={val.uploadImgUlr}\n                      alt=\"...\"\n                      onClick={() => handleSeeImage(val.uploadImgUlr)}\n                    />\n                  </td>\n                  <td>{val.SubmitGoal.inputValues.eventName}</td>\n                  <td>{val.userName}</td>\n                  <td>{val.SubmitGoal.inputValues.numberOfDays} days</td>\n                  <td>\n                    {takeNumberOfDays > val.SubmitGoal.inputValues.numberOfDays\n                      ? \"late\"\n                      : \"submit on time\"}\n                  </td>\n                  <td>{val.SubmitGoal.inputValues.category}</td>\n                  <td>{`${val.SubmitGoal.inputValues.rewardMin} - ${val.SubmitGoal.inputValues.rewardMax}`}</td>\n                  <td className=\"actions_btns\">\n                    {!btn ? (\n                      <button onClick={() => openApprovedForm(val)}>\n                        approved\n                      </button>\n                    ) : null}\n                    {!declineBtn ? (\n                      !undoFunc ? (\n                        <button\n                          className=\"view_icons\"\n                          onClick={() => handleDeclineGoals(val)}\n                        >\n                          decline\n                        </button>\n                      ) : (\n                        <button\n                          className=\"view_icons\"\n                          onClick={\n                            !approvedUndo\n                              ? () => handleUndoDeclineGoals(val)\n                              : () => handleApprovedUndo(val)\n                          }\n                        >\n                          Undo\n                        </button>\n                      )\n                    ) : null}\n                    {/* button for decline if goal is reported  */}\n                    {declineForReported ? (\n                      <button\n                        className=\"view_icons\"\n                        onClick={() => handleDeclineReportGoals(val)}\n                      >\n                        Accept Report\n                      </button>\n                    ) : null}\n                    {undoForReported ? (\n                      <button\n                        className=\"view_icons\"\n                        onClick={() => handleUndoReportedGoals(val)}\n                      >\n                        undo reported\n                      </button>\n                    ) : null}\n                    {undoFake ? (\n                      <button\n                        className=\"view_icons\"\n                        onClick={() => handleUndoFakeGoals(val)}\n                      >\n                        undo fake\n                      </button>\n                    ) : null}\n                  </td>\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n};\n\nexport default SubmitGoalsTable;\n"]},"metadata":{},"sourceType":"module"}